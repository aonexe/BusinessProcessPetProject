CREATE TABLE stage_result
(
    stage_result_id   INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    stage_result_name VARCHAR(30) UNIQUE NOT NULL,
    created_at        TIMESTAMP          NOT NULL,
    created_who       INT                NOT NULL,
    updated_at        TIMESTAMP,
    updated_who       INT DEFAULT NULL,
    FOREIGN KEY (updated_who) REFERENCES bp_user (user_id)
);

INSERT INTO stage_result (stage_result_name, created_at, created_who)
VALUES ('NOT_STARTED', now(), 1),
       ('IN_PROGRESS', now(), 1),
       ('APPROVE', now(), 1),
       ('REJECT', now(), 1);

ALTER TABLE stage
    ADD COLUMN stage_result_id INT REFERENCES stage_result (stage_result_id);

UPDATE stage
SET stage_result_id = stage_result.stage_result_id
FROM stage_result
WHERE stage_result.stage_result_name = stage.stage_result;

ALTER TABLE stage
    DROP COLUMN stage_result;


